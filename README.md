**WARNING**: this project has mostly been written by AI ðŸ˜„

# What is this?
This python application scans block comments in code containing a special tag and transforms them into Notion pages. 

As an example:
```kotlin
/* NOTION.Application 
 This application says hello
*/
fun main(args: Array<String>) {
    val name = "World"
    /*** NOTION.Application.Functions
     * # This is a comment
     * - and here a list
     * - with two items
     * */
    println("Hello, " + name + "!")
}
```

The first comment will generate a page named `Application` with the text "This application says hello".  
With the second comment, a page `Functions` will be created inside the `Application` page, containing the text 
`This is a comment` and a list with two items.

It's possible to use both `.` and `/` as separators in the tag. Additionally, the notation `NOTION.*` will
use the previous tag *in the same file*, so to not repeat it in following comments.
Adding a pound symbol (`#`) and a number at the end of the tag will be used to sort multiple comments on the same page.
Comments without a number default to sort index `1000`, so you can use numbers lower than 1000 to appear before default comments,
or higher than 1000 to appear after. For example, `NOTION.Application#1` will appear first, `NOTION.Application#2000` will appear last.

## Tag Options
You can add options to NOTION tags using bracket notation: `NOTION[option1,option2].Page.Path`.

### Available Options

#### `include_all`
The `include_all` option automatically collects all non-tagged block comments that appear after the tagged comment and appends them to the page content.

Example:
```kotlin
/* NOTION[include_all].Application
 * Main application description
 */

/* Implementation details that we want to include */

/* More notes about the implementation */

/* NOTION.OtherPage
 * This is a separate page
 */

/* This comment won't be included in Application */
```

In this example, the `Application` page will contain:
- "Main application description"
- "Implementation details that we want to include"
- "More notes about the implementation"

The `OtherPage` will only contain "This is a separate page" (since it doesn't have the `include_all` option).

# Supported languages
- Kotlin
- Java
- PHP
- Plain MD files

# Configuration
Use a config file named `notion-docs.yaml` (or `notion-docs.yml`).
```yaml
root: ./
root_page_id: YOUR_NOTION_ROOT_PAGE_ID
titles_matching: prefix
header: "This page is automatically generated by Notion Docs. Do not edit manually."
quote_color: gray
inline_code_color: blue
```
- `root` is the directory where the source code is located.
- `root_page_id` is the ID of the root page in Notion.
- (optional) `header` is the header to add to the top of each generated page
- (optional) `include_file_in_header` set to `true` to include the list of source files in the header.
- (optional) `titles_matching` is the title matching strategy (all are case-insensitive). Possible values are:
  - (default) `title_only` : matches the exact title of the page
  - `prefix`: matches only if the page title starts with the indicated prefix; symbols are ignored; useful if pages have a numbering or coding scheme.
  - `mnemonic`: matches only if the provided segment equals the computed mnemonic of the page title (see algorithm below); In the case of multiple sibling pages with same mnemonic, the behavior is undefined.
- (optional) `quote_color` is the color to apply to blockquote blocks (both the text and the vertical bar). Default is `default`.
- (optional) `inline_code_color` is the color to apply to inline code segments. Default is `default`.

### Color Options
Valid color values for `quote_color` and `inline_code_color`:
- **Standard colors**: `default`, `gray`, `brown`, `orange`, `yellow`, `green`, `blue`, `purple`, `pink`, `red`
- **Background colors**: `gray_background`, `brown_background`, `orange_background`, `yellow_background`, `green_background`, `blue_background`, `purple_background`, `pink_background`, `red_background`

Plus set an environment variable `NOTION_API_KEY` with the API key of your Notion connection.


### Mnemonic
To address pages, as an alternative to the exact page title, it's possible to use a mnemonic with a standardized format.
Here is how it is calculated:
- Ignore spaces and symbols.
- Three uppercase letters or numbers.
- The first letter of the code is the first letter of the title.
- The following two characters are the next to consonants of the word.
- If not enough consonants are available, use the vowels starting from the beginning.
- If the title is to short, the missing characters are replaced with `X`.

Examples:
- "Alpha Beta Gamma" â†’ ALP
- "Echo" â†’ ECH
- "why" â†’ WHY
- "Idea 123" â†’ IDE
- "A1" â†’ A1X
- "C# Sharp Developer" â†’ CSH
- "123abc" â†’ 1BC
- "!!!" â†’ XXX


# Notion Setup
- create a private Notion connection and get the API key
- create a notion page and add the connection to it
- get the page ID and set it in the config file
- transform the page into a wiki
- create properties `Subtree Hash` and `Text Hash`


# Usage

- Ensure you have Python 3.9+ installed.
- Install dependencies:

```bash
pip install -r requirements.txt
```

- Set the Notion API key environment variable (replace with your key):

```bash
export NOTION_API_KEY="secret_xxx_your_notion_integration_key"
```

- Create or update the config file notion-docs.yaml in the directory you want to scan (see Configuration above). For example:

```yaml
root: ./
root_page_id: YOUR_NOTION_ROOT_PAGE_ID
titles_matching: prefix
```

- Run the sync:

```bash
python3 main.py --config /path/to/dir-or-config-file
```

Useful flags:
- -v or --verbose to enable debug logging
- --log-level {CRITICAL,ERROR,WARNING,INFO,DEBUG,NOTSET} to set an explicit level
- --force to ignore hashes and update all pages regardless of changes

Examples:

```bash
# From the project root, using a config file in the current directory
python3 main.py --config .

# Use a different folder that contains notion-docs.yaml
python3 main.py --config ~/code/my-project

# Force full re-sync with verbose logging
python3 main.py --config . --force -v
```

## Using the GitHub Action
Prerequisites:
- Prepare Notion as explained above.
- Create the configuration file `notion-docs.yaml` in your project.
- Add the key to your GitHub repository secrets (`NOTION_TOKEN` in the example below).
- Set the configuration file folder relative to the root of your project (default is `.`).
- Add the action to your workflow.

Example workflow:

```yaml
name: Notion Docs Sync
on:
  workflow_dispatch: {}

jobs:
  notion-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: PaoloConte/notion-code-docs@main
        with:
          notion-token: ${{ secrets.NOTION_TOKEN }}
          config: .
```


# Notes
- The script NEVER deletes pages from Notion. If a page becomes empty, you should delete it manually.
- Some IDEs, such as IntelliJ, may strip spaces at the end of lines; this interferes with markdown parsing
  where double spaces are used to indicate a line break; so it may be useful to disable this feature.
- Pay attention to the indentation of the comments, all lines should be aligned
