**WARNING**: this project has mostly been written by AI ðŸ˜„

# What is this?
This python application scans block comments in code containing a special tag and transforms them into Notion pages. 

As an example:
```kotlin
/* NOTION.Application 
 This application says hello
*/
fun main(args: Array<String>) {
    val name = "World"
    /*** NOTION.Application.Functions
     * # This is a comment
     * - and here a list
     * - with two items
     * */
    println("Hello, " + name + "!")
}
```

The first comment will generate a page named `Application` with the text "This application says hello".  
With the second comment, a page `Functions` will be created inside the `Application` page, containing the text 
`This is a comment` and a list with two items.

Adding a pound symbol (`#`) and a number at the end of the tag will be used to sort multiple comments on the same page.
For example, `NOTION.Application#1` will be the first comment on the page. The default sort index is a high number.

It's possible to use both `.` and `/` as separators in the tag.

# Supported languages
- Kotlin
- Java
- PHP
- Plain MD files

# Configuration
Use a config file named `notion-docs.yaml` (or `notion-docs.yml`).
```yaml
root: ./
root_page_id: YOUR_NOTION_ROOT_PAGE_ID
titles_matching: prefix
header: "This page is automatically generated by Notion Docs. Do not edit manually."
```
- `root` is the directory where the source code is located.
- `root_page_id` is the ID of the root page in Notion.
- `header` is the header to add to the top of each generated page. If not set, no header is added.`
- `titles_matching` is the title matching strategy (all are case-insensitive). Possible values are:
  - `title_only` (default): matches the exact title of the page
  - `prefix`: matches only if the page title starts with the indicated prefix; symbols are ignored; useful if pages have a numbering or coding scheme.
  - `mnemonic`: matches only if the provided segment equals the computed mnemonic of the page title (see algorithm below); In the case of multiple sibling pages with same mnemonic, the behavior is undefined.

Plus set an environment variable `NOTION_API_KEY` with the API key of your Notion connection.


### Mnemonic
To address pages, as an alternative to the exact page title, it's possible to use a mnemonic with a standardized format.
Here is how it is calculated:
- Ignore spaces and symbols.
- Three uppercase letters or numbers.
- The first letter of the code is the first letter of the title.
- The following two characters are the next to consonants of the word.
- If not enough consonants are available, use the vowels starting from the beginning.
- If the title is to short, the missing characters are replaced with `X`.

Examples:
- "Alpha Beta Gamma" â†’ ALP
- "Echo" â†’ ECH
- "why" â†’ WHY
- "Idea 123" â†’ IDE
- "A1" â†’ A1X
- "C# Sharp Developer" â†’ CSH
- "123abc" â†’ 1BC
- "!!!" â†’ XXX


# Notion Setup
- create a private Notion connection and get the API key
- create a notion page and add the connection to it
- get the page ID and set it in the config file
- create properties `Subtree Hash` and `Text Hash`


# Usage

- Ensure you have Python 3.9+ installed.
- Install dependencies:

```bash
pip install -r requirements.txt
```

- Set the Notion API key environment variable (replace with your key):

```bash
export NOTION_API_KEY="secret_xxx_your_notion_integration_key"
```

- Create or update the config file notion-docs.yaml in the directory you want to scan (see Configuration above). For example:

```yaml
root: ./
root_page_id: YOUR_NOTION_ROOT_PAGE_ID
titles_matching: prefix
```

- Run the sync:

```bash
python3 main.py --config /path/to/dir-or-config-file
```

Useful flags:
- -v or --verbose to enable debug logging
- --log-level {CRITICAL,ERROR,WARNING,INFO,DEBUG,NOTSET} to set an explicit level
- --force to ignore hashes and update all pages regardless of changes

Examples:

```bash
# From the project root, using a config file in the current directory
python3 main.py --config .

# Use a different folder that contains notion-docs.yaml
python3 main.py --config ~/code/my-project

# Force full re-sync with verbose logging
python3 main.py --config . --force -v
```

# Notes
- Some IDEs, such as IntelliJ, may strip spaces at the end of lines; this interferes with markdown parsing 
where double spaces are used to indicate a line break; so it may be useful to disable this feature.
- Pay attention to the indentation of the comments, all lines should be aligned


## Using the GitHub Action
Prerequisites:
- Prepare Notion as explained above.
- Create the configuration file `notion-docs.yaml` in your project.
- Add the key to your GitHub repository secrets as NOTION_API_KEY.
- Add the action to your workflow.

Example workflow:

```yaml
name: Notion Docs Sync
on:
  workflow_dispatch: {}

jobs:
  notion-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: PaoloConte/notion-code-docs
        with:
          notion-token: ${{ secrets.NOTION_TOKEN }}
          config: .
```
